# hello-bevy è¨­è¨ˆã‚µãƒãƒª

## ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†ãƒ«ãƒ¼ãƒ«
**é‡è¦**: ã“ã®CLAUDE.mdãƒ•ã‚¡ã‚¤ãƒ«ã¯å¸¸ã«æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã¤ã“ã¨
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›´æ™‚ã¯å¿…ãšã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
- è¨­è¨ˆå¤‰æ›´ã€æ–°æ©Ÿèƒ½è¿½åŠ ã€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆå¤‰æ›´ã‚’å³åº§ã«åæ˜ 
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’æ­£ç¢ºã«æ–‡æ›¸åŒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä¸€èˆ¬çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚‚ã“ã“ã«è¨˜éŒ²

## ğŸ—£ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å±¥æ­´
### é–‹ç™ºæ™‚ã®æ³¨æ„äº‹é …
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª**: å¤‰æ›´å¾Œã¯å¿…ãš`cargo check`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: ä¸€èˆ¬çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨
- **UIåˆ†é›¢**: å…·ä½“çš„ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã¯main.rsã«ã€æ±ç”¨çš„ãªUIãƒ­ã‚¸ãƒƒã‚¯ã¯ui.rsã«åˆ†é›¢ã™ã‚‹ã“ã¨
- **JSONè¨­å®š**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ruleã¯JSONå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿å¯èƒ½ã«ãªã£ãŸï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ä»˜ãï¼‰

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
src/
â”œâ”€â”€ main.rs             - Bevyã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆãƒ»ã‚²ãƒ¼ãƒ å›ºæœ‰è¨­å®š
â”œâ”€â”€ ui.rs               - æ±ç”¨çš„ãªUIè¡¨ç¤ºãƒ»å…¥åŠ›å‡¦ç†
â”œâ”€â”€ battle_system.rs    - ãƒãƒˆãƒ«ç®¡ç†ãƒ»ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
â”œâ”€â”€ action_system.rs    - ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹è¡Œå‹•è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ rule_loader.rs      - JSONå½¢å¼ãƒ«ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ãƒ»å¤‰æ›æ©Ÿèƒ½
â””â”€â”€ rule_input_model.rs - JSONå…¥åŠ›ç”¨ãƒ«ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
rules/
â”œâ”€â”€ player_rules.json - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«è¨­å®š
â””â”€â”€ enemy_rules.json  - æ•µã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«è¨­å®š
```

### ğŸ¯ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢è¨­è¨ˆ
- **ã‚¢ãƒ—ãƒªå±¤**: `main.rs` - Bevyã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆãƒ»ã‚²ãƒ¼ãƒ å›ºæœ‰è¨­å®š
- **UIå±¤**: `ui.rs` - æ±ç”¨çš„ãªUIè¡¨ç¤ºãƒ»å…¥åŠ›å‡¦ç†
- **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤**: `battle_system.rs` - ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
- **è¨ˆç®—å±¤**: `action_system.rs` - AIè¡Œå‹•ã‚·ã‚¹ãƒ†ãƒ 
- **è¨­å®šå±¤**: `rule_loader.rs` - JSONå¤–éƒ¨ãƒ«ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
- **å…¥åŠ›ãƒ¢ãƒ‡ãƒ«å±¤**: `rule_input_model.rs` - JSONå…¥åŠ›ç”¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©

## ğŸ§© ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### 1. ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ
```rust
// battle_system.rs
struct Character {
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
    hp/max_hp, mp/max_mp, attack
}

struct Battle {
    // æˆ¦é—˜çŠ¶æ…‹ç®¡ç†
    player, enemy, current_turn, battle_over
}
```

### 2. ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ (`action_system.rs`)
```rust
trait Token {
    fn evaluate() -> TokenResult
}

enum TokenResult {
    Continue(bool),  // æ¡ä»¶åˆ¤å®šçµæœ
    Action(ActionType), // å®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    Break,           // è¡Œä¸­æ–­
}

// å¤–éƒ¨ã‹ã‚‰ãƒ«ãƒ¼ãƒ«è¨­å®šå¯èƒ½
ActionCalculationSystem::new(rules)
ActionCalculationSystem::with_seed(rules, seed)
```

### 3. è²¬ä»»åˆ†é›¢è¨­è¨ˆ
- **`main.rs`**: Bevyã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ»ã‚²ãƒ¼ãƒ å›ºæœ‰è¨­å®š("å‹‡è€…","ã‚¹ãƒ©ã‚¤ãƒ ")
- **`ui.rs`**: æ±ç”¨çš„ãªUIè¡¨ç¤ºãƒ»å…¥åŠ›å‡¦ç†ãƒ»ç”»é¢æç”»
- **`battle_system.rs`**: æˆ¦é—˜ãƒ«ãƒ¼ãƒ«ãƒ»ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†
- **`action_system.rs`**: AIè¡Œå‹•æ±ºå®šãƒ»ãƒˆãƒ¼ã‚¯ãƒ³å‡¦ç†ãƒ»å¤–éƒ¨ãƒ«ãƒ¼ãƒ«è¨­å®š

### 4. æ‹¡å¼µæ€§è¨­è¨ˆ
- **æ–°ãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ **: `Token`ãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…ã®ã¿
- **æ–°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ **: `ActionType`enumæ‹¡å¼µ
- **UIå¤‰æ›´**: `ui.rs`ã®ã¿ä¿®æ­£ã§å¯¾å¿œ
- **ã‚²ãƒ¼ãƒ è¨­å®šå¤‰æ›´**: `main.rs`ã®ã¿ä¿®æ­£ã§å¯¾å¿œ
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«**: JSONå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ«ãƒ¼ãƒ«è¨­å®šå¯èƒ½ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ä»˜ãï¼‰

### 5. JSONè¨­å®šã‚·ã‚¹ãƒ†ãƒ 
```rust
// rule_input_model.rs
RuleSet { rules: [RuleChain{ tokens: [TokenConfig] }] }
TokenConfig: Strike | Heal | Check{args} | GreaterThan{args} | etc.

// rule_loader.rs
load_rules_from_file(path) -> parse_rules_from_json(content) -> convert_to_token_rules(rule_set)
```
- **å…¥åŠ›ãƒ¢ãƒ‡ãƒ«**: `rule_input_model.rs` - JSONå…¥åŠ›å°‚ç”¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©
- **ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿**: `load_rules_from_file(path)`
- **JSONè§£æ**: `parse_rules_from_json(content)`
- **å¤‰æ›å‡¦ç†**: `convert_to_token_rules(rule_set)`
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: JSONèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ
```
å…¥åŠ› â†’ ui.rs â†’ battle_system.rs â†’ action_system.rs â†’ ui.rs â†’ çµæœè¡¨ç¤º
      â†‘                                                         â†“
   main.rs (ã‚²ãƒ¼ãƒ è¨­å®š)                                    ç”»é¢æç”»
```

## ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«

### ä¾å­˜é–¢ä¿‚ã®éšå±¤æ§‹é€ 
```
main.rs
â”œâ”€â”€ ui.rs (UIå±¤)
â”œâ”€â”€ battle_system.rs (ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤)
â”‚   â””â”€â”€ action_system.rs (è¨ˆç®—å±¤)
â”œâ”€â”€ rule_loader.rs (è¨­å®šå±¤)
â”‚   â””â”€â”€ rule_input_model.rs (å…¥åŠ›ãƒ¢ãƒ‡ãƒ«å±¤)
â””â”€â”€ rule_input_model.rs (å…¥åŠ›ãƒ¢ãƒ‡ãƒ«å±¤)
```

### ä¾å­˜é–¢ä¿‚ã®åˆ¶ç´„ãƒ«ãƒ¼ãƒ«

1. **ä¸Šä½å±¤ â†’ ä¸‹ä½å±¤ã®ä¾å­˜ã®ã¿è¨±å¯**
   - `main.rs` â†’ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜å¯èƒ½
   - `battle_system.rs` â†’ `action_system.rs`ã®ã¿ä¾å­˜
   - `rule_loader.rs` â†’ `rule_input_model.rs` + `action_system.rs`ä¾å­˜
   - **é€†æ–¹å‘ä¾å­˜ã¯ç¦æ­¢** (ä¸‹ä½å±¤ãŒä¸Šä½å±¤ã«ä¾å­˜ã—ã¦ã¯ã„ã‘ãªã„)

2. **åŒä¸€å±¤å†…ã®ç›¸äº’ä¾å­˜ã¯ç¦æ­¢**
   - `ui.rs` â†” `battle_system.rs`ã®ç›´æ¥ä¾å­˜ã¯ç¦æ­¢
   - `rule_loader.rs` â†” `ui.rs`ã®ç›´æ¥ä¾å­˜ã¯ç¦æ­¢

3. **ç‹¬ç«‹æ€§ã‚’ä¿ã¤ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**
   - `rule_input_model.rs`: ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ä¾å­˜ã—ãªã„å®Œå…¨ç‹¬ç«‹
   - `action_system.rs`: `battle_system.rs`ã«ã®ã¿ä¾å­˜ï¼ˆCharacterã®å‹å®šç¾©ï¼‰

4. **è¨±å¯ã•ã‚Œã‚‹ä¾å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³**
   ```rust
   // âœ… è¨±å¯
   main.rs â†’ ui.rs, battle_system.rs, rule_loader.rs
   battle_system.rs â†’ action_system.rs
   rule_loader.rs â†’ rule_input_model.rs, action_system.rs
   
   // âŒ ç¦æ­¢
   action_system.rs â†’ battle_system.rs (é€†æ–¹å‘)
   ui.rs â†’ rule_loader.rs (åŒä¸€å±¤)
   rule_input_model.rs â†’ any module (å®Œå…¨ç‹¬ç«‹)
   ```

5. **æ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ æ™‚ã®ãƒ«ãƒ¼ãƒ«**
   - ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¢ºã«å®šç¾©ã—ã¦ã‹ã‚‰å®Ÿè£…é–‹å§‹
   - å¾ªç’°ä¾å­˜ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ç¢ºèª
   - ã‚ˆã‚Šä¸‹ä½ã®å±¤ã«é…ç½®ã§ããªã„ã‹æ¤œè¨

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨­è¨ˆ
### çµ±åˆãƒ†ã‚¹ãƒˆ (31ãƒ†ã‚¹ãƒˆ)
- **action_system.rs**: å˜ä½“ãƒ†ã‚¹ãƒˆ + çµ±åˆãƒ†ã‚¹ãƒˆ
- **battle_system.rs**: å˜ä½“ãƒ†ã‚¹ãƒˆ + æ§˜ã€…ãªãƒ«ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
- **ãƒ«ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹**:
  - æ”»æ’ƒå°‚ç”¨/å›å¾©å°‚ç”¨ãƒ«ãƒ¼ãƒ«
  - è¤‡é›‘ãªãƒ«ãƒ¼ãƒ«ãƒã‚§ã‚¤ãƒ³
  - ç©ºãƒ«ãƒ¼ãƒ«ãƒ»æ±ºå®šè«–çš„å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
